<!DOCTYPE html>
<!--
    Copyright (c) 2012-2016 Adobe Systems Incorporated. All rights reserved.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=yes" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

    <link rel="stylesheet" type="text/css" href="css/index.css" />
	<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script src="bootstrap/js/jquery-3.2.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
	  
	
	<style>
body {margin:0;}

ul.footer {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: lightgray;
    position: fixed;
    bottom: 0;
    width: 100%;
}

li.lifooter {
    float: left;
}

li.lifooter a {
    display: block;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
}

li.lifooter a:hover:not(.active) {
   */ background-color: #111;*/
}

.active {
 */   background-color: #4CAF50;*/
}
</style>
	
    <title>Bolão Megasena</title>
	
	<script>
		 function pegaImagens(id)
		{
         var params = "id="+id;
                var resultado = 0;
                var xmlhttp = new XMLHttpRequest();
				
                xmlhttp.open("GET","https://projetofauna.jbrj.gov.br/listafotos.php?"+params,false);
                xmlhttp.onload = function (){
                    if (xmlhttp.status==200)
                        {
						   	var html = this.responseText;
							document.getElementById("imagem").innerHTML = html;
                        }
                    else if (xmlhttp.status == 404) {
                        alert("Web Service doesn't work");
                    }
                    else
                        {
                            alert("Unknown erro occurred while trying insert data");
                        }
                };
                xmlhttp.send();
                return resultado;       
     }
	</script>
	
	
</head>

<body>
<ul class="footer">
  <li class="lifooter"></span></li>
</ul>

<!-- Modal content-->
 <div class="modal fade" id="myModalSobre" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Bolão Megasena</h4>
        </div>
        <div class="modal-body">
          <div class="form-group">
			<label for="email">Conta para depósito<br>
			</label>
			<label for="email">Banco 001 - Banco do Brasil<br>
			</label>
			<label for="email">Agencia 1572-5<br>
			</label>
			<label for="email">Conta: 9.058-1<br>
			</label>
			<label for="email">Rafael Oliveira Lima<br>
			</label>
			<label for="email">CPF: 038817487-09<br>
			</label>
		  </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">Fechar</button>
        </div>
      </div>
	 </div>
	</div>



	<nav class="navbar navbar-default">
	  <div class="container-fluid">
		<div class="navbar-header">
		  	
		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>	
		  </button>
		  

<a class="navbar-brand" href="index2.html">Bolão 0.1</a>
		  <span id="div_dadoslogin" ></span>

		</div>
		<div class="collapse navbar-collapse" id="myNavbar">	
			<ul class="nav navbar-nav">
			  <li class="active"><a data-toggle="pill" href="#home">Home</a></li>
			  <li class='hidden'><a data-toggle="pill" href="#novoconcurso" >Novo Concurso</a></li>
			  <li><a onclick='novoconcurso()'>Cadastro Concurso</a></li>
			  <!--<li><a onclick='meuschamados()'>Meus Lotes</a></li>-->
			  <li><a onclick='carregaatendimento()'>Consulta Extrato</a></li>
			  <li class=""><a data-toggle="pill" href="#myModalSobre">Conta para depósito</a></li>
			  <li><a onclick=''>Enviar SMS Cobrança</a></li>
			  <li class='hidden'><a data-toggle="pill" href="#consatendimento">Cons. Atendimento</a></li>
			  <li class='hidden'><a data-toggle="pill" href="#consextrato">Cons. Atendimento</a></li>
			  <li><a data-toggle="pill" href="#trocarsenha"><span class="glyphicon glyphicon-log-in"></span> Trocar Senha</a></li>
			  <li><a data-toggle="pill" href="#login"><span class="glyphicon glyphicon-user"></span> Login</a></li>
			  <li><a onclick='exitFromApp()'><span class="glyphicon glyphicon-log-out"></span> Sair</a></li>
			</ul>
			
		</div>
	  </div>
	</nav>
	
	<input type='hidden' name='idusuario' id='idusuario' value=''>
	<input type='hidden' name='nome' id='nome' value=''>
	<div class="tab-content" id="mytab">
	
		<div id="consatendimento" class="tab-pane fade">
			<div class="container" id='chamados'>
			</div>
		</div>

		<div id="consextrato" class="tab-pane fade">
			<div class="container" id='divextrato'>
			</div>
		</div>
	
		<div id="novoconcurso" class="tab-pane fade">
		  <form name='frmchamado' id='frmchamado' method='post'>
			<div class="container">
				<h3>Concurso</h3>
				<div class="form-group">
					<label for="edtdataconcurso">Data Concurso:</label>
					<input type="text" class="form-control input-sm" id="edtdataconcurso" name="edtdataconcurso" value="">
				</div>
				<div class="form-group">
					<label for="edtnumeroconcurso">Número Concurso Ref:</label>
					<input type="text" class="form-control input-sm" id="edtnumeroconcurso" name="edtnumeroconcurso" value="">
				</div>
				<div class="form-group">
					<label for="edtvaloraposta">Valor Aposta:</label>
					<input type="text" class="form-control input-sm" id="edtvaloraposta" name="edtvaloraposta">
				</div>
				<div class="form-group">
					<label for="edtquantidade">Quantidade participantes:</label>
					<input type="text" class="form-control input-sm" id="edtquantidade" name="edtquantidade">
				</div>
				<button type="button" class="btn btn-success btn-block" onclick="salvarconcurso()">Salvar</button>
			</div>
			
			</form>
		</div>
	
		

		<div id="login" class="tab-pane fade">
			<div class="container">
				<div class="app">
					<!--<h1>Fauna JBRJ</h1>-->
			
				
				<div class="form-group">
					<label for="email">Usuário:</label>
					<input type="text" class="form-control" id="edtlogin">
					<input type="hidden" class="form-control" id="edtuuid">
				</div>
				<div class="form-group">
					<label for="pwd">Senha:</label>
					<input type="password" class="form-control" id="edtsenha">
				</div>
				<button  type="button" onclick='login()' class="btn btn-success btn-block">Enviar</button>
				
				</div>
			</div>
		</div>
		
		<div id="trocarsenha" class="tab-pane fade">
			<div class="container">
				<h3>Alterar Senha</h3>
					<!--<h1>Fauna JBRJ</h1>-->
				<div class="form-group">
					<label for="novasenha">Nova senha:</label>
					<input type="text" class="form-control" id="edtnovasenha">
				</div>
				<div class="form-group">
					<label for="confirmacaosenha">Confirmação da senha:</label>
					<input type="text" class="form-control" id="edtconfirmacaosenha">
				</div>
				<button  type="button" onclick='alterarSenha()' class="btn btn-success btn-block">Enviar</button>
				
			</div>
		</div>
		
		
		<div id="home" class="tab-pane fade in active">
			<div class="container">
				<div class="app">
					<!--<h1>Fauna JBRJ</h1>-->
					<div id="deviceready" class="blink">
						<p class="event listening">Conectando</p>
						<p class="event received">Pronto para o uso</p>
					</div>
					<br>
				</div>
				<div class="app2">
					<div class="container" id='chamadosparaatender'>
					</div>
				</div>
				
			</div>
			
		</div>

	</div>
	
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
		$("ul").on("click", function(){

			$('.navbar-collapse').collapse('hide');
			
		});

		
		function alterarSenha()
		{
			var novasenha = document.getElementById('edtnovasenha').value;
			var confirmacaosenha = document.getElementById('edtconfirmacaosenha').value;
			var codusuario = window.localStorage.getItem("idusuario");
			var params = "idusuario="+codusuario+"&senha="+novasenha;
			var resultado = 0;
			var xmlhttp = new XMLHttpRequest();
			
			xmlhttp.open("GET","http://tempustecnologia.com/acoes/exec.alterarsenha.php?"+params,true);
			xmlhttp.onload = function (){
			if (xmlhttp.status==200)
				{
					var str = xmlhttp.responseText;
					//alert(str);
					if (str==true)
					{
						navigator.notification.alert(
									'Alterado com sucesso.',  // message
									alertDismissed,         // callback
									'Atenção',            // title
									'OK'                  // buttonName
						);
						//alert('alterado com sucesso');
					}
					else
					{
						navigator.notification.alert(
									'Não foi possível alterar.',  // message
									alertDismissed,         // callback
									'Atenção',            // title
									'OK'                  // buttonName
						);
						//alert('Não foi possível alterar');
					}
					$('#myNavbar a[href="#home"]').tab('show');
				}
				else if (xmlhttp.status == 404) {
					alert("Web Service doesn't work");
				}
				else
				{
					alert("Unknown erro occurred while trying insert data");
				}
			};
			xmlhttp.send();
			return resultado;  
		}

		function novoconcurso()
		{
			
			var idusuario = window.localStorage.getItem("idusuario");
			if (idusuario == null) {
				$('#myNavbar a[href="#login"]').tab('show');
				
			}
			else
			{
				$('#myNavbar a[href="#novoconcurso"]').tab('show');
				//document.getElementById('edtsolicitante').value=window.localStorage.getItem('uname');
				document.getElementById('edtvaloraposta').value='';
				document.getElementById('edtdataconcurso').value='';
				document.getElementById('edtnumeroconcurso').value='';
				document.getElementById('edtquantidade').value='';
				$(".botao").removeAttr("disabled");
				var date = new Date();
				var day = date.getDate();
				var month = date.getMonth();
				var year = date.getFullYear();
				document.getElementById("edtdataconcurso").value = day + '/' + (month+1) + '/' + year;

			}
		
		
		}
		
		function meuschamados()
		{
					

		// retorna uma lista de chamados que pertence ao usuário logado
		// caso não esteja logado, redireciona para a pagina de login
			var idusuario = window.localStorage.getItem("idusuario");
			if (idusuario == null)
			{
				$('#myNavbar a[href="#login"]').tab('show');
			}
			else
			{
				$('#myNavbar a[href="#consatendimento"]').tab('show');
				getMeusChamados();
			}
		}
		
		// id = id do chamado
		// fitro 
		// 0 todos
		// 7 uma semana
		// 15 dias
		// 30 dias
		
		function carregaatendimento() 
		{

		    var idusuario = window.localStorage.getItem("idusuario");
			if (idusuario == null) 
			{
				$('#myNavbar a[href="#login"]').tab('show');
			}
			else
			{			
				$('#myNavbar a[href="#consextrato"]').tab('show');
				getExtrato(idusuario);
		   }
		}
		
		function exitFromApp(){
		   window.localStorage.clear();
		   navigator.app.exitApp();
		}
		

		function leftPad(value, totalWidth, paddingChar) {
			var length = totalWidth - value.toString().length + 1;
			return Array(length).join(paddingChar || '0') + value;
		};


		
		function salvarconcurso()
		{
			if ((document.getElementById('edtvaloraposta').value=='') ||
			(document.getElementById('edtdataconcurso').value=='') ||
			(document.getElementById('edtnumeroconcurso').value=='') ||
			(document.getElementById('edtquantidade').value=='')
			)
			{
				navigator.notification.alert(
									'Verifique o preenchimento dos campos.',  // message
									alertDismissed,         // callback
									'Atenção',            // title
									'OK'                  // buttonName
								);

				//alert('Verifique o preenchimento dos campos Solicitante, local e descrição.');
				/*
				navigator.notification.alert(
				'Verifique o preenchimento dos campos Solicitante, local e descrição.',  // message
				alertDismissed,         // callback
				'Atenção',            // title
				'OK'                  // buttonName
				);
				*/
			}
			else
			{
				var codusuario = window.localStorage.getItem("idusuario");

				var quantidade = document.getElementById('edtquantidade').value;
				var valor = document.getElementById('edtvaloraposta').value;
				var datacompra = document.getElementById('edtdataconcurso').value;

				var params = "op=I&edtquantidade="+quantidade+"&edtvalorcompra="+valor+"&edtdatacompra="+datacompra+"&codusuario="+codusuario;
                //alert(params);
				var resultado = 0;
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET","http://tempustecnologia.com/acoes/exec.lote.php?"+params,false);
		
                xmlhttp.onload = function (){
                    if (xmlhttp.status==200)
                        {
        					resultado = xmlhttp.responseText;
							carregaatendimento();
                        }
                    else if (xmlhttp.status == 404) {
                        alert("Web Service doesn't work");
                        
                    }
                    else
                        {
                            alert("Unknown erro occurred while trying insert data");
                        }
                };
                xmlhttp.send();
				
        }
     }

	 

	 

		function preencheDadosChamado(id)
		{
			var params = "id="+id;
            var resultado = 0;
            var xmlhttp = new XMLHttpRequest();
			//alert('3');
            xmlhttp.open("GET","http://tempustecnologia.com/acoes/getlotejson.php?"+params,true);
            xmlhttp.onload = function ()
			{
                if (xmlhttp.status==200)
                {
					//alert(xmlhttp.status);
					//alert(this.responseText);
					var myObj = JSON.parse(this.responseText);
					
//					document.getElementById("cmboxcorretora2").value= myObj.idcorretora;
//					document.getElementById("cmboxempresa2").value= myObj.idempresa;
					var str = myObj.datacompra; 
					   var ano = str.substr(0, 4);
					   var mes = str.substr(5, 2);
					   var dia = str.substr(8, 2);

					
					document.getElementById("edtdatacompra2").value =  dia + '/'+mes+'/'+ano;// myObj.datacompra;
					
					
					document.getElementById("edtvalorcompra2").value = myObj.valorcompra;
					document.getElementById("edtquantidade2").value = myObj.quantidade;
					document.getElementById('edtdatavenda2').value=myObj.datavenda;
					
					var str = myObj.datavenda; 
					if (str.length>2)
					{
					   var ano = str.substr(0, 4);
					   var mes = str.substr(5, 2);
					   var dia = str.substr(8, 2);
					   document.getElementById('edtdatavenda2').value=dia + '/'+mes+'/'+ano;
					}
					else
					{
						document.getElementById('edtdatavenda2').value = '';
					}

					
					document.getElementById("edtvalorvenda2").value= myObj.valorvenda;
							
							//document.getElementById("edtdata").value= myObj.data;
							
					/*var d = new Date(myObj.data);
					var datestring = d.getDate()  + "/" + (d.getMonth()+1) + "/" + d.getFullYear() + " " +
					d.getHours() + ":" + d.getMinutes();
							
					document.getElementById("edtdata").value= datestring;
							
					document.getElementById("edtatendimento2").value= myObj.atendimento;
						*/	
							
					/*if (myObj.idsituacaochamado=='3')
					{
						// retirei a linha a pedido da GABI para na fase de teste
						// eles poderem excluir o chamado após estar fechado
						
						//$(".botao").attr("disabled","");
					}
					else
					{
						$(".botao").removeAttr("disabled");
					}
					*/
							//alert(myObj.latitude);
							//elements.classList.addClass(" disabled ");
							//elements.classList.remove("disabled");
							
							//disabled
							
//document.getElementById("iframemapa").innerHTML='<img src="https://maps.googleapis.com/maps/api/staticmap?center=Brooklyn+Bridge,New+York,NY&zoom=13&size=400x300&maptype=roadmap&markers=color:red%7Clabel:S%7C'+myObj.latitude+','+myObj.longitude+'">';
                }
                else if (xmlhttp.status == 404) {
                    alert("Web Service doesn't work");
                }
                else
                {
                   alert("Unknown erro occurred while trying insert data");
                }
            };
            xmlhttp.send();
			//alert('4');
            return resultado; 
								
		}
	 
		function getExtrato(id)
		{
         var params = "idusuario="+id;
                var resultado = 0;
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET","http://tempustecnologia.com/acoes/getextrato.php?"+params,true);
                xmlhttp.onload = function (){
                    if (xmlhttp.status==200)
                        {
						    var str = xmlhttp.responseText;
							document.getElementById("divextrato").innerHTML=str;
							/*alert(id);
							if (id==0)
							{
							}
							else
							{
								document.getElementById("chamados").innerHTML=str;
							}
							*/
						}
                    else if (xmlhttp.status == 404) {
                        alert("Web Service doesn't work");
                    }
                    else
                        {
                            alert("Unknown erro occurred while trying insert data");
                        }
                };
                xmlhttp.send();
                return resultado;       
       }
		function getMeusChamados()
		{
		 var codusuario = window.localStorage.getItem("idusuario");
		 //var codusuario = document.getElementById('idusuario').value;
//		 alert(codusuario);
         var params = "idusuario="+codusuario;
                var resultado = 0;
                var xmlhttp = new XMLHttpRequest();
				
                xmlhttp.open("GET","http://tempustecnologia.com/acoes/getlote.php?"+params,true);
                xmlhttp.onload = function (){
                    if (xmlhttp.status==200)
                        {
						    var str = xmlhttp.responseText;
							document.getElementById("chamados").innerHTML=str;
                        }
                    else if (xmlhttp.status == 404) {
                        alert("Web Service doesn't work");
                    }
                    else
                        {
                            alert("Unknown erro occurred while trying insert data");
                        }
                };
                xmlhttp.send();
                return resultado;       
       }
	   
	   
	   function mostraChamadosParaAtender(id)
	   {
	   //alert('');
			var params = "idusuario="+id; // para atender
            var resultado = 0;
            var xmlhttp = new XMLHttpRequest();
				
                xmlhttp.open("GET","http://tempustecnologia.com/acoes/getresumoconta.php?"+params,true);
                xmlhttp.onload = function (){
                    if (xmlhttp.status==200)
                        {
						    var str = xmlhttp.responseText;
							document.getElementById("chamadosparaatender").innerHTML=str;
                        }
                    else if (xmlhttp.status == 404) {
                        alert("Web Service doesn't work");
                    }
                    else
                        {
                            alert("Unknown erro occurred while trying insert data");
                        }
                };
                xmlhttp.send();
				return resultado;   
	   }
		
		function alertDismissed() {

		}

		
		function login()
		{
		//alert('1');
		var login = document.getElementById('edtlogin').value;
		var senha = document.getElementById('edtsenha').value;
		var uuid = document.getElementById('edtuuid').value;
		//alert(ime);
		//alert(uuid);

	     //document.getElementById('edtlabel').innerHTML="Usuario: "+usuario+" Lat/Long: "+latitude + ','+ longitude + ' Equipe: '+equipe;
         var params = "edtlogin="+login+"&edtsenha="+senha+"&edtuuid="+uuid;
                var resultado = 0;
                var xmlhttp = new XMLHttpRequest();
                //alert(latitude);
				
                xmlhttp.open("GET","http://tempustecnologia.com/acoes/testaloginapp.php?"+params,false);
				//xmlhttp.setRequestHeader( 'Access-Control-Allow-Origin', '*');
				xmlhttp.onload = function (){
					//alert(xmlhttp.status);
					if (xmlhttp.status==200)
                        {
						    var str = xmlhttp.responseText;
							//alert(str);
							if (str.substring(0, 4)=='ERRO')
							{
								document.getElementById('div_dadoslogin').innerHTML='<p class="navbar-text">LOGIN INVÁLIDO</p>';

								/*navigator.notification.alert(
									'Não foi possível efetuar o login.',  // message
									alertDismissed,         // callback
									'Atenção',            // title
									'OK'                  // buttonName
								);
								*/
								alert('Não foi possível efetuar o login.');
							}
							else
							{
								
								var res = str.split("|");
								//alert(res[0]);
								var codusuario = res[0];
								var username = res[1];
								//var idtiposuaurio = res[2];
								//var tiposuaurio = res[3];
								//var idsituacaousuario = res[4];

								window.localStorage.setItem("uname", username);
								window.localStorage.setItem("idusuario",codusuario);
								
								document.getElementById('div_dadoslogin').innerHTML='<p class="navbar-text">'+username+'</p>';
								
								document.getElementById('idusuario').value=window.localStorage.getItem("idusuario");
								document.getElementById('nome').value=window.localStorage.getItem("uname");
								// rafael
								//alert('Login efetuado com sucesso. Cod:'+window.localStorage.getItem("idusuario")+' - '+window.localStorage.getItem("uname"));
								/*navigator.notification.alert(
				'Login efetuado com sucesso.',  // message
				alertDismissed,         // callback
				'Atenção',            // title
				'OK'                  // buttonName
				);
				*/
								$('#myNavbar a[href="#home"]').tab('show');

								/*
								navigator.notification.alert(
				'Login efetuado com sucesso.',  // message
				alertDismissed,         // callback
				'Atenção',            // title
				'OK'                  // buttonName
				);
				*/
								//alert('Login efetuado com sucesso');
								
							/*	navigator.notification.alert(
    'Usuário: '+res[1],  // message
    alertDismissed,         // callback
    'Login',            // title
    'OK'                  // buttonName
);
	*/							//$("#login").removeClass("in active");
								//$("#busca").addClass("in active");
                            }

							//alert(params);
                            //alert(xmlhttp.responseText);
							//$('#myNavbar a[href="#home"]').tab('show');
							//alert(codusuario);
							if (codusuario!='')
							{
								mostraChamadosParaAtender(codusuario);
							}

                        }
                    else if (xmlhttp.status == 404) {
                        alert("Web Service doesn't work");
                        
                    }
                    else
                        {
                            alert("Unknown erro occurred while trying insert data");
                        }
                };
                xmlhttp.send();
                return resultado;
				
         
     }
	 
	$( document ).ready(function() {
		// Handler for .ready() called.
		
		/*		
		var idusuario = window.localStorage.getItem("idusuario");
		//alert(idusuario);
		if (idusuario == null)
		{
			$('#myNavbar a[href="#login"]').tab('show');
		}
		else
		{
			$('#myNavbar a[href="#home"]').tab('show');
		}
		*/
	});


    </script>
</body>

</html>